<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>ToxiCheck - Toxicity Analysis Tool</title>
		<script src="https://cdn.tailwindcss.com"></script>
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
		/>
	</head>
	<body
		class="min-h-screen bg-gradient-to-r from-indigo-100 via-purple-100 to-pink-100 font-sans"
	>
		<header
			class="bg-white/30 backdrop-blur-md border-b border-white/30 px-6 py-4 shadow-md sticky top-0 z-50"
		>
			<div class="flex items-center justify-between max-w-7xl mx-auto">
				<!-- Left side - Logo and Navigation -->
				<div class="flex items-center space-x-8">
					<h1 class="text-2xl font-bold text-gray-900">ToxiCheck</h1>
				</div>

				<!-- Right side - History button -->
				<div class="flex items-center space-x-4">
					<button
						class="flex items-center bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors font-semibold"
					>
						<i class="fas fa-clock mr-2"></i>
						History
					</button>
				</div>
			</div>
		</header>

		<!-- Main Content -->
		<main
			class="max-w-4xl mx-auto px-6 py-8 bg-white/30 backdrop-blur-md rounded-xl shadow-lg border border-white/30 mt-8"
		>
			<!-- Enter Text Section -->
			<section class="mb-8">
				<h2 class="text-3xl font-semibold text-gray-900 mb-2">
					Analyze social media comments
				</h2>
				<p class="text-gray-700 mb-4 text-lg">
					Paste your comment or text content
				</p>

				<textarea
					id="input-text"
					class="w-full h-32 p-4 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg"
					placeholder="Type or paste your text here..."
				>
Wow, your brain must be on permanent vacation. It's amazing how someone can be this clueless and still function. People like you are the reason warning labels exist. Keep talking like that, and someone’s going to lose their patience—seriously. You’re one walking disaster away from getting smacked. Just shut it already</textarea
				>

				<button
					id="analyze-btn"
					class="mt-4 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors text-lg font-semibold flex items-center justify-center space-x-2"
				>
					<span>Analyze</span>
				</button>
			</section>

			<!-- Results Section -->
			<section id="results-section" class="hidden">
				<h2 class="text-3xl font-semibold text-gray-900 mb-6">Results</h2>

				<!-- Toxicity Analysis Card -->
				<div
					class="bg-white rounded-lg border border-gray-200 p-6 mb-6 shadow-md"
				>
					<div class="flex items-center space-x-3 mb-4">
						<div
							class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center"
						>
							<i class="fas fa-check text-white"></i>
						</div>
						<div>
							<h3 class="text-xl font-semibold text-gray-900">
								Toxicity Analysis
							</h3>
							<p class="text-gray-600">
								Your text has been analyzed for toxicity. See details below.
							</p>
						</div>
					</div>

					<!-- Toxicity Score -->
					<div class="mb-6">
						<h4 class="text-xl font-medium text-gray-900 mb-2">
							Toxicity Score
						</h4>
						<div id="toxicity-score" class="text-5xl font-bold text-red-500">
							0 / 10
						</div>
					</div>

					<!-- Category Breakdown -->
					<div class="mb-6">
						<h4 class="text-xl font-medium text-gray-900 mb-4">
							Category Breakdown
						</h4>
						<div
							id="bars-container"
							class="flex items-end space-x-4 h-48"
						></div>
					</div>

					<!-- Highlighted Text -->
					<div class="mb-6">
						<h4 class="text-xl font-medium text-gray-900 mb-4">
							Highlighted Text
						</h4>
						<div
							id="highlighted-text"
							class="bg-gray-50 p-4 rounded-lg text-gray-700 text-lg"
						>
							<!-- Text will go here -->
						</div>
					</div>

					<!-- Export Button -->
					<button
						class="bg-blue-100 text-blue-700 px-4 py-2 rounded-lg hover:bg-blue-200 transition-colors flex items-center"
					>
						<i class="fas fa-file-pdf mr-2"></i>
						Export as PDF
					</button>
				</div>
			</section>

			<!-- Spinner Section -->
			<section
				id="loading-spinner"
				class="hidden flex justify-center items-center py-12"
			>
				<svg
					class="animate-spin -ml-1 mr-3 h-12 w-12 text-blue-600"
					xmlns="http://www.w3.org/2000/svg"
					fill="none"
					viewBox="0 0 24 24"
				>
					<circle
						class="opacity-25"
						cx="12"
						cy="12"
						r="10"
						stroke="currentColor"
						stroke-width="4"
					></circle>
					<path
						class="opacity-75"
						fill="currentColor"
						d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"
					></path>
				</svg>
			</section>
		</main>

		<script>
			const analyzeBtn = document.getElementById('analyze-btn');
			const resultsSection = document.getElementById('results-section');
			const loadingSpinner = document.getElementById('loading-spinner');

			const toxicityScoreEl = document.getElementById('toxicity-score');
			const highlightedTextEl = document.getElementById('highlighted-text');
			const barsContainer = document.getElementById('bars-container');

			// The 11 categories you want to handle
			const categoriesList = [
				'insult',
				'threat',
				'obscene',
				'hate',
				'sexual_explicit',
				'identity_attack',
				'profanity',
				'toxicity',
				'severe_toxicity',
				'flirtation',
			];

			// Colors for each category for clarity (you can adjust)
			const categoryColors = {
				insult: '#2563EB', // blue-600
				threat: '#DC2626', // red-600
				obscene: '#D97706', // amber-600
				hate: '#9333EA', // purple-600
				sexual_explicit: '#DB2777', // pink-600
				identity_attack: '#14B8A6', // teal-500
				profanity: '#F59E0B', // amber-500
				toxicity: '#EF4444', // red-500
				severe_toxicity: '#B91C1C', // red-700
				flirtation: '#8B5CF6', // violet-500
				other: '#4B5563', // gray-600
			};

			function simulateApiCall() {
				return fetch('http://127.0.0.1:8000/check', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({
						text: document.getElementById('input-text').value,
					}),
				})
					.then((response) => {
						if (!response.ok) throw new Error(`HTTP error ${response.status}`);
						return response.json();
					})
					.then((data) => {
						const resultText = data.result || '{}';
						try {
							return data;
						} catch (err) {
							console.error('Failed to parse model response:', resultText);
							throw err;
						}
					});
			}

			function renderBars(categories) {
				barsContainer.innerHTML = ''; // Clear old bars

				const maxBarHeight = 180; // px

				categoriesList.forEach((cat) => {
					const value = categories[cat] ?? 0;
					const heightPx = value * maxBarHeight;

					// Create bar container
					const barWrapper = document.createElement('div');
					barWrapper.className = 'flex flex-col items-center';

					// Percentage label above the bar
					const percentLabel = document.createElement('div');
					percentLabel.className = 'text-sm text-gray-700 mb-1 font-semibold';
					percentLabel.textContent = `${(value * 100).toFixed(1)}%`;
					barWrapper.appendChild(percentLabel);

					// Bar itself
					const bar = document.createElement('div');
					bar.style.height = heightPx + 'px';
					bar.style.width = '48px';
					bar.style.backgroundColor = categoryColors[cat] || '#2563EB';
					bar.className = 'rounded-t transition-all duration-500';
					barWrapper.appendChild(bar);

					// Category label below
					const label = document.createElement('span');
					label.className = 'text-sm text-gray-600 mt-2';
					label.textContent = cat.replace(/_/g, ' ');
					label.textContent = label.textContent.toUpperCase();
					barWrapper.appendChild(label);

					barsContainer.appendChild(barWrapper);
				});
			}

			analyzeBtn.addEventListener('click', async () => {
				resultsSection.classList.add('hidden');
				loadingSpinner.classList.remove('hidden');

				try {
					const result = await simulateApiCall();

					toxicityScoreEl.textContent = `${result.toxicityScore.toFixed(
						1
					)} / 10`;

					renderBars(result.categories);

					highlightedTextEl.innerHTML = result.highlightedText;

					resultsSection.classList.remove('hidden');
				} catch (error) {
					console.error('Error during analysis:', error);
					alert('Failed to analyze text. Please try again at a later time.');
				} finally {
					loadingSpinner.classList.add('hidden');
				}
			});
		</script>
	</body>
</html>
